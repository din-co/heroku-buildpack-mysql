#!/bin/sh
echo "-----> Installing Mysql 5.1"
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

indent() {
  sed -u 's/^/       /'
}

echo "-----> Downloading minimized tarball"
cd $CACHE_DIR
# download the minimal mysql tar file
wget -nv https://raw.githubusercontent.com/din-co/mysql-binary/master/mysql.tar.gz 2>&1 | indent

cd $BUILD_DIR
# make a directory to untar (like unzip) the binary
mkdir -p $BUILD_DIR/mysql
# untar the binary to a directory inside /app/.heroku
tar -C $BUILD_DIR/mysql -xvf $CACHE_DIR/mysql.tar.gz | indent
# Ensure binaries are in PATH and libraries are in LD_LIBRARY_PATH
cat > .profile.d/mysql.sh <<EOF
export PATH=$PATH:/app/mysql/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/app/mysql/lib
EOF
