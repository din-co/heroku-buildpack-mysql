#!/bin/sh
echo "-----> Installing Mysql 5.1"
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

indent() {
  sed -u 's/^/       /'
}

echo "-----> Downloading minimized tarball"
cd $CACHE_DIR
# download the minimal mysql tar file
wget -nv https://raw.githubusercontent.com/din-co/mysql-binary/master/mysql.tar.gz | indent

cd $BUILD_DIR
# make a directory to untar (like unzip) the binary
mkdir -p $BUILD_DIR/mysql
# untar the binary to a directory inside /app/.heroku
tar -C $BUILD_DIR/mysql -xvf $CACHE_DIR/mysql.tar.gz | indent
# Ensure binaries are in PATH and libraries are in LD_LIBRARY_PATH
cat > .profile.d/mysql <<EOF
# Add mysql binaries to PATH
export PATH=$PATH:$BUILD_DIR/mysql/bin
# Add mysql libraries to shared library search paths
export LIBRARY_PATH=$LIBRARY_PATH:$BUILD_DIR/mysql/lib
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$BUILD_DIR/mysql/lib
EOF
